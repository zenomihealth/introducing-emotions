"use strict";(self.webpackChunk_articulate_mondrian_bundles=self.webpackChunk_articulate_mondrian_bundles||[]).push([[151],{2151:(t,e,n)=>{n.r(e),n.d(e,{createUpgradePath:()=>Te,getConverter:()=>Ae,getTransformSteps:()=>Ce,getVersionClaim:()=>De,upgrade:()=>Ee});var i=n(2),a=n(3537),l=n(8683),o=n(6195);const r=o.z.object({id:o.z.string(),path:o.z.string(),name:o.z.string(),width:o.z.number().optional(),height:o.z.number().optional()}),u=o.z.object({unit:o.z.enum(["px","%","auto","fr"]),value:o.z.number()}),d=o.z.object({applied:o.z.boolean().default(!1),type:o.z.enum(["none","fill"]).default("none"),color:o.z.string().default("#000000"),opacity:o.z.number().default(1),style:o.z.enum(["solid","dashed","dotted"]).default("solid"),width:u.default({value:1,unit:"px"})}),z=o.z.object({assetId:o.z.string().optional(),color:o.z.string().optional(),opacity:o.z.number().min(0).max(1).default(1)}),s=z.extend({type:o.z.literal("color"),color:o.z.string().default("#e4e4e4")}),c=o.z.object({width:o.z.number(),height:o.z.number(),left:o.z.number(),top:o.z.number()}),p=z.extend({type:o.z.literal("image"),assetId:o.z.string(),crop:c.default({width:1,height:1,left:0,top:0})}),f=z.extend({type:o.z.literal("none")}),b=o.z.discriminatedUnion("type",[s,p,f]),g=o.z.discriminatedUnion("type",[s,f]),m=o.z.object({top:u.default({value:0,unit:"px"}),left:u.default({value:0,unit:"px"}),bottom:u.default({value:0,unit:"px"}),right:u.default({value:0,unit:"px"})}),x=o.z.object({id:o.z.string(),name:o.z.string().max(128)}),y=x.extend({x:u.default({value:0,unit:"px"}),y:u.default({value:0,unit:"px"}),xOffset:o.z.number().default(0),yOffset:o.z.number().default(0),position:o.z.literal("absolute").default("absolute"),width:u.default({value:100,unit:"%"}),height:u.default({value:100,unit:"%"}),padding:m,fill:b,overlay:g,aspectRatioLocked:o.z.boolean(),border:d,borderRadius:o.z.object({applied:o.z.boolean().default(!1),topLeft:u.default({value:0,unit:"px"}),topRight:u.default({value:0,unit:"px"}),bottomRight:u.default({value:0,unit:"px"}),bottomLeft:u.default({value:0,unit:"px"})}),rotation:o.z.number().default(0),flipX:o.z.boolean().default(!1),flipY:o.z.boolean().default(!1)}),h=o.z.object({id:o.z.string(),event:o.z.enum(["click","hover"])}),v=h.extend({action:o.z.literal("changeState"),targetId:o.z.string(),targetState:o.z.string().default("default")}),j=h.extend({action:o.z.literal("changeVisibility"),targetId:o.z.string(),targetVisibility:o.z.boolean()}),k=o.z.discriminatedUnion("action",[v,j]),I=t=>o.z.intersection(x,t.partial()),S=t=>o.z.intersection(o.z.object({default:t}),o.z.record(I(t))),w=t=>o.z.object({id:o.z.string(),blockumentId:o.z.string(),clonedFromId:o.z.string().optional(),parentId:o.z.string(),type:o.z.string(),name:o.z.string().max(128),tagName:o.z.enum(["div","figure","figcaption","blockquote"]).default("div"),locked:o.z.boolean().default(!1),authoringVisible:o.z.boolean().default(!0),initialVisible:o.z.boolean().default(!0),initialState:o.z.string().default("default"),states:S(t),triggers:o.z.array(k),assets:o.z.record(r).default({}).optional(),removed:o.z.boolean().default(!1)}),R=(I(y),o.z.object({id:o.z.string(),clonedFromId:o.z.string().optional(),state:o.z.string(),visible:o.z.boolean()})),O=o.z.object({id:o.z.string(),title:o.z.string().max(255),children:o.z.array(R).max(1)}),P=y.extend({children:o.z.array(R)}),U=w(P).extend({type:o.z.literal("group")}),_=(I(P),y.extend({altText:o.z.string().default("")})),L=w(_).extend({type:o.z.literal("image")}),V=(I(_),o.z.intersection(o.z.object({type:o.z.string().optional(),attrs:o.z.record(o.z.any()).optional(),content:o.z.array(o.z.lazy((()=>V))).optional(),marks:o.z.array(o.z.intersection(o.z.object({type:o.z.string(),attrs:o.z.record(o.z.any()).optional()}),o.z.record(o.z.any()))).optional(),text:o.z.string().optional()}),o.z.record(o.z.any()))),E=o.z.object({id:o.z.string(),type:o.z.literal("tiptap"),json:V}),T=o.z.enum(["top","middle","bottom"]),C=y.extend({text:E,textVerticalAlign:T.default("top")}),A=w(C).extend({type:o.z.literal("text")}),D=(I(C),C.extend({clipPath:o.z.literal("ellipse").nullable().default(null),altText:o.z.string().nullable().default(null)})),N=w(D).extend({type:o.z.literal("shape")}),F=(I(D),o.z.object({default:o.z.string()})),M=y.extend({videoSources:F}),q=w(M).extend({type:o.z.literal("video")}),B=(I(M),o.z.discriminatedUnion("type",[U,L,N,A,q])),K=o.z.object({blockuments:o.z.record(O).optional(),items:o.z.record(B).optional()});var X;!function(t){t.APP="app",t.BLOCKUMENT="blockument",t.COURSE="course"}(X||(X={}));const Y=o.z.object({id:o.z.string(),path:o.z.string(),name:o.z.string(),width:o.z.number().optional(),height:o.z.number().optional()}),G=o.z.object({unit:o.z.enum(["px","%","auto","fr"]),value:o.z.number()}),H=o.z.object({applied:o.z.boolean().default(!1),type:o.z.enum(["none","fill"]).default("none"),color:o.z.string().default("#000000"),opacity:o.z.number().default(1),style:o.z.enum(["solid","dashed","dotted"]).default("solid"),width:G.default({value:1,unit:"px"})}),J=o.z.object({assetId:o.z.string().optional(),color:o.z.string().optional(),opacity:o.z.number().min(0).max(1).default(1)}),Q=J.extend({type:o.z.literal("color"),color:o.z.string().default("#e4e4e4")}),W=o.z.object({width:o.z.number(),height:o.z.number(),left:o.z.number(),top:o.z.number()}),Z=J.extend({type:o.z.literal("image"),assetId:o.z.string(),crop:W.default({width:1,height:1,left:0,top:0})}),$=J.extend({type:o.z.literal("none")}),tt=o.z.discriminatedUnion("type",[Q,Z,$]),et=o.z.discriminatedUnion("type",[Q,$]),nt=o.z.object({top:G.default({value:0,unit:"px"}),left:G.default({value:0,unit:"px"}),bottom:G.default({value:0,unit:"px"}),right:G.default({value:0,unit:"px"})}),it=o.z.object({id:o.z.string(),name:o.z.string().max(128)}),at=it.extend({x:G.default({value:0,unit:"px"}),y:G.default({value:0,unit:"px"}),xOffset:o.z.number().default(0),yOffset:o.z.number().default(0),position:o.z.literal("absolute").default("absolute"),width:G.default({value:100,unit:"%"}),height:G.default({value:100,unit:"%"}),padding:nt,fill:tt,overlay:et,aspectRatioLocked:o.z.boolean(),border:H,borderRadius:o.z.object({applied:o.z.boolean().default(!1),topLeft:G.default({value:0,unit:"px"}),topRight:G.default({value:0,unit:"px"}),bottomRight:G.default({value:0,unit:"px"}),bottomLeft:G.default({value:0,unit:"px"})}),rotation:o.z.number().default(0),flipX:o.z.boolean().default(!1),flipY:o.z.boolean().default(!1)}),lt=t=>o.z.intersection(it,t.partial()),ot=t=>o.z.intersection(o.z.object({default:t}),o.z.record(lt(t))),rt=t=>o.z.object({id:o.z.string(),blockumentId:o.z.string(),clonedFromId:o.z.string().optional(),parentId:o.z.string(),type:o.z.string(),name:o.z.string().max(128),tagName:o.z.enum(["div","figure","figcaption","blockquote"]).default("div"),locked:o.z.boolean().default(!1),authoringVisible:o.z.boolean().default(!0),initialVisible:o.z.boolean().default(!0),initialState:o.z.string().default("default"),states:ot(t),assets:o.z.record(Y).default({}).optional(),removed:o.z.boolean().default(!1)}),ut=(lt(at),o.z.object({id:o.z.string(),clonedFromId:o.z.string().optional(),state:o.z.string(),visible:o.z.boolean()})),dt=o.z.object({id:o.z.string(),event:o.z.enum(["click","hover","mediaPlay","mediaPause","mediaEnd"]),sourceId:o.z.string().optional()}),zt=dt.extend({action:o.z.enum(["mediaPause","mediaPlay","mediaEnd"]),targetId:o.z.string()}),st=dt.extend({action:o.z.literal("changeState"),targetId:o.z.string(),targetState:o.z.string().default("default")}),ct=dt.extend({action:o.z.literal("changeVisibility"),targetId:o.z.string(),targetVisibility:o.z.boolean()}),pt=o.z.discriminatedUnion("action",[st,ct,zt]),ft=o.z.object({id:o.z.string(),title:o.z.string().max(255),children:o.z.array(ut).max(1),triggers:o.z.array(pt)}),bt=at.extend({children:o.z.array(ut)}),gt=rt(bt).extend({type:o.z.literal("group")}),mt=(lt(bt),at.extend({altText:o.z.string().default("")})),xt=rt(mt).extend({type:o.z.literal("image")}),yt=(lt(mt),o.z.intersection(o.z.object({type:o.z.string().optional(),attrs:o.z.record(o.z.any()).optional(),content:o.z.array(o.z.lazy((()=>yt))).optional(),marks:o.z.array(o.z.intersection(o.z.object({type:o.z.string(),attrs:o.z.record(o.z.any()).optional()}),o.z.record(o.z.any()))).optional(),text:o.z.string().optional()}),o.z.record(o.z.any()))),ht=o.z.object({id:o.z.string(),type:o.z.literal("tiptap"),json:yt}),vt=o.z.enum(["top","middle","bottom"]),jt=at.extend({text:ht,textVerticalAlign:vt.default("top")}),kt=rt(jt).extend({type:o.z.literal("text")}),It=(lt(jt),jt.extend({clipPath:o.z.literal("ellipse").nullable().default(null),altText:o.z.string().nullable().default(null)})),St=rt(It).extend({type:o.z.literal("shape")}),wt=(lt(It),o.z.object({default:o.z.string()})),Rt=at.extend({videoSources:wt}),Ot=rt(Rt).extend({type:o.z.literal("video")}),Pt=(lt(Rt),o.z.discriminatedUnion("type",[gt,xt,St,kt,Ot])),Ut=o.z.object({blockuments:o.z.record(ft).optional(),items:o.z.record(Pt).optional()});var _t;o.z.object({id:o.z.string(),blockumentId:o.z.string(),name:o.z.string().max(128)}),function(t){t.APP="app",t.BLOCKUMENT="blockument",t.COURSE="course"}(_t||(_t={}));var Lt=n(3134),Vt=n(4348);const Et=o.z.object({id:o.z.string(),path:o.z.string(),name:o.z.string(),width:o.z.number().optional(),height:o.z.number().optional()}),Tt=o.z.object({unit:o.z.enum(["px","%","auto","fr"]),value:o.z.number()}),Ct=o.z.object({applied:o.z.boolean().default(!1),type:o.z.enum(["none","fill"]).default("none"),color:o.z.string().default("#000000"),opacity:o.z.number().default(1),style:o.z.enum(["solid","dashed","dotted"]).default("solid"),width:Tt.default({value:1,unit:"px"})}),At=o.z.object({assetId:o.z.string().optional(),color:o.z.string().optional(),opacity:o.z.number().min(0).max(1).default(1)}),Dt=At.extend({type:o.z.literal("color"),color:o.z.string().default("#e4e4e4")}),Nt=o.z.object({width:o.z.number(),height:o.z.number(),left:o.z.number(),top:o.z.number()}),Ft=At.extend({type:o.z.literal("image"),assetId:o.z.string(),crop:Nt.default({width:1,height:1,left:0,top:0})}),Mt=At.extend({type:o.z.literal("none")}),qt=o.z.discriminatedUnion("type",[Dt,Ft,Mt]),Bt=o.z.discriminatedUnion("type",[Dt,Mt]),Kt=o.z.object({top:Tt.default({value:0,unit:"px"}),left:Tt.default({value:0,unit:"px"}),bottom:Tt.default({value:0,unit:"px"}),right:Tt.default({value:0,unit:"px"})}),Xt=o.z.object({id:o.z.string(),name:o.z.string().max(128)}),Yt=Xt.extend({x:Tt.default({value:0,unit:"px"}),y:Tt.default({value:0,unit:"px"}),xOffset:o.z.number().default(0),yOffset:o.z.number().default(0),position:o.z.literal("absolute").default("absolute"),width:Tt.default({value:100,unit:"%"}),height:Tt.default({value:100,unit:"%"}),padding:Kt,fill:qt,overlay:Bt,aspectRatioLocked:o.z.boolean(),border:Ct,borderRadius:o.z.object({applied:o.z.boolean().default(!1),topLeft:Tt.default({value:0,unit:"px"}),topRight:Tt.default({value:0,unit:"px"}),bottomRight:Tt.default({value:0,unit:"px"}),bottomLeft:Tt.default({value:0,unit:"px"})}),rotation:o.z.number().default(0),flipX:o.z.boolean().default(!1),flipY:o.z.boolean().default(!1)}),Gt=t=>o.z.intersection(Xt,t.partial()),Ht=t=>o.z.intersection(o.z.object({default:t}),o.z.record(Gt(t))),Jt=t=>o.z.object({id:o.z.string(),blockumentId:o.z.string(),clonedFromId:o.z.string().optional(),parentId:o.z.string(),type:o.z.string(),name:o.z.string().max(128),tagName:o.z.enum(["div","figure","figcaption","blockquote"]).default("div"),locked:o.z.boolean().default(!1),authoringVisible:o.z.boolean().default(!0),initialVisible:o.z.boolean().default(!0),initialState:o.z.string().default("default"),states:Ht(t),assets:o.z.record(Et).default({}).optional(),removed:o.z.boolean().default(!1),_v:o.z.literal(3)}),Qt=(Gt(Yt),o.z.object({default:o.z.string()})),Wt=Yt.extend({audioSources:Qt}),Zt=Jt(Wt).extend({type:o.z.literal("audio")}),$t=(Gt(Wt),o.z.object({id:o.z.string(),clonedFromId:o.z.string().optional(),state:o.z.string(),visible:o.z.boolean()})),te=o.z.object({id:o.z.string(),event:o.z.enum(["click","hover","mediaPlay","mediaPause","mediaEnd"]),sourceId:o.z.string().optional()}),ee=te.extend({action:o.z.enum(["mediaPause","mediaPlay","mediaEnd"]),targetId:o.z.string()}),ne=te.extend({action:o.z.literal("changeState"),targetId:o.z.string(),targetState:o.z.string().default("default")}),ie=te.extend({action:o.z.literal("changeVisibility"),targetId:o.z.string(),targetVisibility:o.z.boolean()}),ae=o.z.discriminatedUnion("action",[ne,ie,ee]),le=o.z.object({id:o.z.string(),title:o.z.string().max(255),children:o.z.array($t).max(1),triggers:o.z.array(ae),_v:o.z.literal(3)}),oe=Yt.extend({children:o.z.array($t)}),re=Jt(oe).extend({type:o.z.literal("group")}),ue=(Gt(oe),o.z.intersection(o.z.object({type:o.z.string().optional(),attrs:o.z.record(o.z.any()).optional(),content:o.z.array(o.z.lazy((()=>ue))).optional(),marks:o.z.array(o.z.intersection(o.z.object({type:o.z.string(),attrs:o.z.record(o.z.any()).optional()}),o.z.record(o.z.any()))).optional(),text:o.z.string().optional()}),o.z.record(o.z.any()))),de=o.z.object({id:o.z.string(),type:o.z.literal("tiptap"),json:ue}),ze=o.z.enum(["top","middle","bottom"]),se=Yt.extend({text:de,textVerticalAlign:ze.default("top")}),ce=Jt(se).extend({type:o.z.literal("text")}),pe=(Gt(se),se.extend({clipPath:o.z.literal("ellipse").nullable().default(null),altText:o.z.string().nullable().default(null)})),fe=Jt(pe).extend({type:o.z.literal("shape")}),be=(Gt(pe),o.z.object({default:o.z.string()})),ge=Yt.extend({videoSources:be}),me=Jt(ge).extend({type:o.z.literal("video")}),xe=(Gt(ge),o.z.discriminatedUnion("type",[Zt,re,fe,ce,me])),ye=o.z.object({blockuments:o.z.record(le).optional(),items:o.z.record(xe).optional()});var he;o.z.object({id:o.z.string(),blockumentId:o.z.string(),name:o.z.string().max(128)}),function(t){t.APP="app",t.BLOCKUMENT="blockument",t.COURSE="course"}(he||(he={}));var ve=n(4816);function je(t,e,n){const{default:i,...a}=t;return{default:e(i),...ve(a,n)}}function ke(t){return{...t,altText:"altText"in t?t.altText??null:void 0}}function Ie(t){return{...t,clipPath:null,altText:t.altText??null,text:{id:crypto.randomUUID(),type:"tiptap",json:{type:"doc",content:[]}},textVerticalAlign:"middle"}}function Se(t){return"image"===t.type?function(t){return{...t,_v:3,type:"shape",states:je(t.states,Ie,ke)}}(t):{...t,_v:3}}var we=n(4868);function Re(t){return t.applied?{type:"rectangle",borderRadius:{topLeft:t.topLeft.value,topRight:t.topRight.value,bottomRight:t.bottomRight.value,bottomLeft:t.bottomLeft.value}}:{type:"rectangle"}}function Oe(t){const{clipPath:e,borderRadius:n,...i}=t;return"ellipse"===e?{...i,clipDef:{type:"ellipse"}}:{...i,clipDef:Re(n)}}function Pe(t){const{borderRadius:e,...n}=t;return{...n,clipDef:Re(e)}}function Ue(t){const{borderRadius:e,...n}=t;return e?{...n,clipDef:Re(e)}:{...n}}function _e(t){if("shape"===t.type)return{...t,_v:4,states:je(t.states,Oe,(e=>function(t,e){const{clipPath:n,borderRadius:i,...a}=t;return"ellipse"===n?{...a,clipDef:{type:"ellipse"}}:"ellipse"===e.clipPath?{...a}:i?{...a,clipDef:Re(i)}:{...a}}(e,t.states.default)))};if("text"===t.type)return{...t,_v:4,states:je(t.states,Pe,Ue)};if("video"===t.type)return{...t,_v:4,states:je(t.states,Pe,Ue)};if("group"===t.type)return{...t,_v:4,states:je(t.states,Pe,Ue)};if("audio"===t.type)return{...t,_v:4,states:je(t.states,Pe,Ue)};throw new Error("Internal error: should be unreachable")}const Le=4,Ve=[{version:1,upgrade:function(t){return t},InputSchema:K,OutputSchema:K},{version:2,upgrade:function({blockuments:t,items:e}){const n=t??{},i=Object.values(e??{}).filter((t=>"triggers"in t)),a=Lt(i,"blockumentId"),l={},o={};for(const[t,e]of Object.entries(a)){const i=n[t];if(i){const t=e.flatMap((t=>(t.triggers??[]).map((e=>({...e,sourceId:t.id}))))),a={...i,triggers:t};l[a.id]=a,e.forEach((t=>{o[t.id]=Vt(t,"triggers")})),Object.entries(n).forEach((([t,e])=>{if(!(t in l)){const n={...e,triggers:[]};l[t]=n}}))}}return{blockuments:l,items:o}},InputSchema:K,OutputSchema:Ut},{version:3,upgrade:function({blockuments:t,items:e}){return{blockuments:ve(t??{},(t=>({...t,_v:3}))),items:ve(e??{},Se)}},InputSchema:Ut,OutputSchema:ye},{version:4,upgrade:function(t){return{blockuments:ve(t.blockuments??{},(t=>({...t,_v:4}))),items:ve(t.items??{},_e)}},InputSchema:ye,OutputSchema:we.pL}];function Ee(t){const e=De(t),n=Ae(e).OutputSchema.safeParse(t);if(n.success&&e===Le)return n.data;if(n.success)return Te(e,Le)(n.data);throw new Error("Unable to comply: no upgrade path was found",{cause:n.error})}function Te(t,e){return i(Ce(t,e).map((({InputSchema:t,upgrade:e,OutputSchema:n})=>i(t.parse,e,n.parse))))}function Ce(t,e){const n=a(t+1,e+1),i=Ve.filter((({version:t})=>n.includes(t)));return l(i,"version")}function Ae(t){const e=Ve.find((e=>e.version===t));if(!e)throw new Error("No converter found for claimed version");return e}function De(t){const e=t;let n=Object.values(e?.blockuments??{})[0]?._v??0;return 0===n&&(n=Object.values(e.blockuments).every((t=>t.triggers))?2:1),n}}}]);